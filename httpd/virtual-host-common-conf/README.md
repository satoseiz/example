# httpdの仮想ホストの共通設定

## 概要
Apache HTTP Server (httpd) の仮想ホストの共通設定例を格納した。

詳細は「[Apache HTTP Serverの仮想ホストの共通設定](https://senooken.jp/post/2020/10/28/)」に記している。

httpd v2.4.39で動作を確認している。

## 内容
- `httpd.conf`: メインの設定ファイル。モジュールの読み込みや分離したファイルのIncludeのみ記述。
- `httpd-other.conf`: 仮想ホストごとの設定ファイル。
- `README.md`: このファイル。

## 方法
仮想ホストの設定は，基本的にHTTPとHTTPSの両方の設定を行う必要がある。

そのため，仮想ホストごとにファイル (`httpd-other.conf`) を作り，メインの設定ファイルの`httpd.conf`から`Include`指令で読み込むことで対応すると管理しやすい。

仮想ホストごとのファイルは，ホスト名・ドメイン名で名前を付けておくとわかりやすいだろう。

肝心の仮想ホストごとの設定ファイルでは以下の方針で設定を行う。

1. Defineにより共通のドメインとDOCUMENT_ROOTをマクロ化
2. DOCUMENT_ROOTへのアクセス権限を設定
3. HTTP (80ポート) には最低限の設定とリダイレクト設定のみ指定
4. HTTPS (443ポート) にログの設定も指定

冒頭で定義した`OTHER_DOMAIN`と`OTHER_DOCUMENT_ROOT`でドメイン名とドキュメントルートの重複を回避している。

`Define`指令で指定するマクロは*`httpd.conf`全体で共有*することに注意する。

マクロの競合を回避するため，実際に自分の仮想ホストに適用する際は，`OTHER_`を自分の仮想ホストのホスト名に置換する。それと合わせて，ファイル名も`httpd-other.conf`の`other`の部分をホスト名に変えておく。

3のリダイレクトの設定は，`.htaccess`に任せてもいいだろう。
